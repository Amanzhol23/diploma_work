<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WSP ChatBot</title>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" />
		<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
		<style>
			#response {
				margin-top: 20px;
				padding: 10px;
				min-height: 50px;
			}
			#response h3 {
				color: #333;
				font-size: 1.2em;
			}
			#response strong {
				color: #d9534f;
			}
			#response ul {
				padding-left: 20px;
			}
			#response li {
				margin-bottom: 5px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h2>“Æ–π–¥—ñ“£ –∫”©–º–µ–∫—à—ñ—Å—ñ - –ñ–∞—Å–∞–Ω–¥—ã –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—ñ</h2>
			<div class="form-group">
				<input
					type="text"
					class="form-control"
					id="userInput"
					placeholder="–°“±—Ä–∞“ì—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–¥—ã –±–∞—Å—ã“£—ã–∑" />
			</div>
			<button class="btn btn-success" onclick="sendMessage()">–°“±—Ä–∞“õ!</button>
			<button class="btn btn-primary" onclick="startVoiceInput()">üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω</button>
			<div id="response"></div>
		</div>
		<script>
			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Speech Recognition
			const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
			recognition.lang = 'ru-RU'; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω—É–∂–Ω—ã–π —è–∑—ã–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, 'kk-KZ' –¥–ª—è –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ
			recognition.interimResults = false;
			recognition.maxAlternatives = 1;

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Speech Synthesis
			const synth = window.speechSynthesis;

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞
			function startVoiceInput() {
				recognition.start();
				document.getElementById('response').innerHTML = '–°–ª—É—à–∞—é...';
			}

			recognition.onresult = function(event) {
				const voiceInput = event.results[0][0].transcript;
				document.getElementById('userInput').value = voiceInput;
				sendMessage(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
			};

			recognition.onerror = function(event) {
				document.getElementById('response').innerHTML = '–û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è: ' + event.error;
			};

			// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
			async function sendMessage() {
				const input = document.getElementById('userInput').value;
				const responseDiv = document.getElementById('response');
				if (!input) {
					responseDiv.innerHTML = '–•–∞–±–∞—Ä–ª–∞–º–∞ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.';
					return;
				}
				responseDiv.innerHTML = 'Loading...';
				try {
					const response = await fetch(
						'https://openrouter.ai/api/v1/chat/completions',
						{
							method: 'POST',
							headers: {
								Authorization: 'Bearer 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',
								'HTTP-Referer': 'https://www.sitename.com',
								'X-Title': 'SiteName',
								'Content-Type': 'application/json',
							},
							body: JSON.stringify({
								model: 'deepseek/deepseek-r1:free',
								messages: [{ role: 'user', content: input }],
							}),
						},
					);
					const data = await response.json();
					const markdownText =
						data.choices?.[0]?.message?.content || 'No response received.';
					responseDiv.innerHTML = marked.parse(markdownText);

					// –û–∑–≤—É—á–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç
					const utterance = new SpeechSynthesisUtterance(markdownText);
					utterance.lang = 'ru-RU'; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω—É–∂–Ω—ã–π —è–∑—ã–∫
					synth.speak(utterance);
				} catch (error) {
					responseDiv.innerHTML = 'Error: ' + error.message;
				}
			}
		</script>
	</body>
</html>